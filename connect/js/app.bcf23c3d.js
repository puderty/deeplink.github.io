(function(){var e={4130:function(e,t,o){"use strict";var n=o(5130),l=o(9543),a=(o(4188),o(6768)),s=o(4232);const c=e=>((0,a.Qi)("data-v-dbfc2082"),e=e(),(0,a.jt)(),e),r={id:"app"},i=c((()=>(0,a.Lk)("div",null,"钱包信息",-1))),d=c((()=>(0,a.Lk)("strong",null,"Wallet Address:",-1))),u=c((()=>(0,a.Lk)("strong",null,"当前状态 :",-1))),f=c((()=>(0,a.Lk)("div",null,"钱包操作",-1))),b=c((()=>(0,a.Lk)("strong",null,"Proof verify:",-1))),h=c((()=>(0,a.Lk)("h2",null,"扫描二维码",-1))),p=c((()=>(0,a.Lk)("div",null,"交易",-1))),k=c((()=>(0,a.Lk)("div",{class:"input-label"},"交易数据（可选，有默认） :",-1))),g=c((()=>(0,a.Lk)("div",{class:"input-label"},"签名结果 :",-1))),y=c((()=>(0,a.Lk)("div",null,"本地加解密KeyPair",-1))),_=c((()=>(0,a.Lk)("div",{class:"input-label"},"PubKey:",-1))),v=c((()=>(0,a.Lk)("div",{class:"input-label"},"SecKey:",-1)));function O(e,t,o,l,c,O){const m=(0,a.g2)("el-header"),T=(0,a.g2)("el-col"),P=(0,a.g2)("el-row"),w=(0,a.g2)("el-card"),C=(0,a.g2)("el-input"),N=(0,a.g2)("el-button"),S=(0,a.g2)("qrcode-vue"),F=(0,a.g2)("el-main"),A=(0,a.g2)("el-container");return(0,a.uX)(),(0,a.CE)("div",r,[(0,a.bF)(A,null,{default:(0,a.k6)((()=>[(0,a.bF)(m,null,{default:(0,a.k6)((()=>[(0,a.eW)("OKX Connect")])),_:1}),(0,a.bF)(F,null,{default:(0,a.k6)((()=>[(0,a.bF)(w,{class:"wallet-info"},{header:(0,a.k6)((()=>[i])),default:(0,a.k6)((()=>[(0,a.bF)(P,{class:"info-row"},{default:(0,a.k6)((()=>[(0,a.bF)(T,{span:24},{default:(0,a.k6)((()=>[d,(0,a.eW)(" "+(0,s.v_)(O.getWalletAddress),1)])),_:1})])),_:1}),(0,a.bF)(P,{class:"info-row"},{default:(0,a.k6)((()=>[(0,a.bF)(T,{span:24},{default:(0,a.k6)((()=>[u,(0,a.eW)(" "+(0,s.v_)(e.currentStatus),1)])),_:1})])),_:1})])),_:1}),(0,a.bF)(w,{class:"wallet-actions"},{header:(0,a.k6)((()=>[f])),default:(0,a.k6)((()=>[(0,a.bF)(P,{gutter:12},{default:(0,a.k6)((()=>[(0,a.bF)(T,{span:24},{default:(0,a.k6)((()=>[(0,a.bF)(C,{modelValue:e.testProofPayload,"onUpdate:modelValue":t[0]||(t[0]=t=>e.testProofPayload=t),placeholder:"proofPayload"},null,8,["modelValue"])])),_:1})])),_:1}),(0,a.bF)(P,{class:"info-row"},{default:(0,a.k6)((()=>[(0,a.bF)(T,{span:24},{default:(0,a.k6)((()=>[b,(0,a.eW)(" "+(0,s.v_)(e.ProofPayloadVerify),1)])),_:1})])),_:1}),(0,a.bF)(P,{gutter:12,class:"button-row"},{default:(0,a.k6)((()=>[(0,a.bF)(T,{span:24},{default:(0,a.k6)((()=>[(0,a.bF)(N,{type:"primary",onClick:O.connectBtnClicked,icon:"el-icon-connection"},{default:(0,a.k6)((()=>[(0,a.eW)((0,s.v_)(e.connectStatusStr),1)])),_:1},8,["onClick"])])),_:1})])),_:1}),((0,a.uX)(),(0,a.Wv)(a.Im,{to:"body"},[e.showModal?((0,a.uX)(),(0,a.CE)("div",{key:0,class:"modal-overlay",onClick:t[3]||(t[3]=(...e)=>O.closeModal&&O.closeModal(...e))},[(0,a.Lk)("div",{class:"modal-content",onClick:t[2]||(t[2]=(0,n.D$)((()=>{}),["stop"]))},[(0,a.Lk)("button",{class:"close-button",onClick:t[1]||(t[1]=(...e)=>O.closeModal&&O.closeModal(...e))},"×"),h,(0,a.bF)(S,{value:e.qrValue,size:200,level:"H"},null,8,["value"])])])):(0,a.Q3)("",!0)])),(0,a.bF)(P,{gutter:12,class:"button-row"},{default:(0,a.k6)((()=>[(0,a.bF)(T,{span:24},{default:(0,a.k6)((()=>[(0,a.bF)(N,{type:"warning",onClick:O.resotreConnectAction,icon:"el-icon-refresh-right"},{default:(0,a.k6)((()=>[(0,a.eW)("尝试重连")])),_:1},8,["onClick"])])),_:1})])),_:1}),(0,a.bF)(P,{gutter:12,class:"button-row"},{default:(0,a.k6)((()=>[(0,a.bF)(T,{span:24},{default:(0,a.k6)((()=>[(0,a.bF)(N,{type:"danger",onClick:O.disconnectAction,icon:"el-icon-switch-button",disabled:0==e.walletAddress.length},{default:(0,a.k6)((()=>[(0,a.eW)((0,s.v_)(e.disconnectStatusStr),1)])),_:1},8,["onClick","disabled"])])),_:1})])),_:1})])),_:1}),(0,a.bF)(w,{class:"transaction"},{header:(0,a.k6)((()=>[p])),default:(0,a.k6)((()=>[(0,a.bF)(T,{xs:24,sm:12},{default:(0,a.k6)((()=>[k,(0,a.bF)(C,{modelValue:e.testTransaction,"onUpdate:modelValue":t[4]||(t[4]=t=>e.testTransaction=t),placeholder:"sendTransactions"},null,8,["modelValue"])])),_:1}),(0,a.bF)(T,{xs:24,sm:12},{default:(0,a.k6)((()=>[g,(0,a.bF)(C,{modelValue:e.testboc,"onUpdate:modelValue":t[5]||(t[5]=t=>e.testboc=t),placeholder:"boc"},null,8,["modelValue"])])),_:1}),(0,a.bF)(P,{gutter:12,class:"button-row"},{default:(0,a.k6)((()=>[(0,a.bF)(T,{span:24},{default:(0,a.k6)((()=>[(0,a.bF)(N,{type:"primary",onClick:t[6]||(t[6]=e=>O.sendTransaction())},{default:(0,a.k6)((()=>[(0,a.eW)((0,s.v_)(e.testTransactionStr),1)])),_:1})])),_:1})])),_:1})])),_:1}),(0,a.bF)(w,{class:"keypair-info"},{header:(0,a.k6)((()=>[y])),default:(0,a.k6)((()=>[(0,a.bF)(P,{gutter:12},{default:(0,a.k6)((()=>[(0,a.bF)(T,{xs:24,sm:12},{default:(0,a.k6)((()=>[_,(0,a.bF)(C,{modelValue:e.localPubKey,"onUpdate:modelValue":t[7]||(t[7]=t=>e.localPubKey=t),placeholder:"PublicKey",disabled:""},null,8,["modelValue"])])),_:1}),(0,a.bF)(T,{xs:24,sm:12},{default:(0,a.k6)((()=>[v,(0,a.bF)(C,{modelValue:e.localSecKey,"onUpdate:modelValue":t[8]||(t[8]=t=>e.localSecKey=t),placeholder:"SecretKey",disabled:""},null,8,["modelValue"])])),_:1})])),_:1})])),_:1}),(0,a.bF)(w,{class:"clear-cache"},{default:(0,a.k6)((()=>[(0,a.bF)(P,null,{default:(0,a.k6)((()=>[(0,a.bF)(T,{span:24},{default:(0,a.k6)((()=>[(0,a.bF)(N,{type:"danger",onClick:t[9]||(t[9]=e=>O.clearCacheKeyPair()),icon:"el-icon-delete"},{default:(0,a.k6)((()=>[(0,a.eW)("清理本地缓存")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])}var m=o(3027),T=o(5544),P=o(6788),w=o(9877),C=o(712)["hp"],N=new m.OKXTonConnect({metaData:{name:"测试dapp",icon:"",url:"okx.com"}});window.ton=N;var S=new m.ConnectionManager;async function F(e,t,o,n){try{const l=T.Address.parse(e),a=`${n}\n${l.toString(!0,!0,!0)}`,s=C.from(t,"hex"),c=C.from(o,"base64");return(0,P.signVerify)(C.from(a),c,s)}catch(l){return console.error("Error verifying TON proof:",l),!1}}const A="EQArzP5prfRJtDM5WrMNWyr9yUTAi0c9o6PfR4hkWy9UQXHx",K={timestamp:1684856121,domain:{lengthBytes:21,value:"ton-proof.github.io"},signature:"bGisgGHUoNrbVhAsXHTJv0BX9vTVkBxk3mDxlOWOiglNgMHcmwHI0CYa6VJo1fkz8cZpS0iuNS+gKPXJxdDZBw==",payload:"t0N0ZXN0...",state_init:"...",public_key:"NP1fpOSJcaRe6ILKZtixHssbKdJMvh8c2Mc02JRlpWw="},E=K.signature,I=K.domain.value;F(A,K,E,I).then((e=>{console.log("Signature is valid:",e)})).catch((e=>{console.error("Verification failed:",e)}));var V={name:"App",components:{QrcodeVue:w.A},data:()=>({testTopic:"",testPublicKey:"",testProofPayload:"",pendingDeepLink:"-",logList:[],connectReady:!1,connectStatusStr:"连接钱包",disconnectStatusStr:"断开钱包",localPubKey:"",localSecKey:"",testTransaction:"",testTransactionStr:"发送交易",walletAddress:"",testboc:"",ProofPayloadVerify:"",showModal:!1,qrValue:"https://www.okx.com/download",currentStatus:""}),computed:{updateUniLink:function(){console.log(`update uni link: ${this.testTopic} ${this.testPublicKey}`);let e=m.utils.generateDeepLink({protocolVer:"1",channelId:this.testTopic,clientId:this.testPublicKey,dAppInfo:{name:"test",url:"-",iconUrl:"-"},requestId:"0",testPayload:this.testProofPayload});return e},getWalletAddress:function(){return this.walletAddress}},methods:{async connectBtnClicked(){this.testTonSdk()},async disconnectAction(){console.log("get disconnect wallet btn clicked"),N.disconnect()},async resotreConnectAction(){console.log("get restore wallet btn clicked"),N.restoreConnection()},clearCacheKeyPair:()=>{console.log("generate local key pair"),S.cleanCache()},async sendTransaction(){if(console.log("sendTransaction"),console.log("sendTransaction内容------",this.testTransaction),this.testTransaction){const e=JSON.parse(this.testTransaction);return console.log("sendTransaction--结束-----",e),void N.sendTransaction(e)}let e={messages:[{address:"EQARULUYsmJq1RiZ-YiH-IJLcAZUVkVff-KBPwEmmaQGH6aC",amount:"205000000",payload:"te6cckEBAgEAhwABbQ+KfqUAAADNgG7tIEATEtAIAO87mQKicbKgHIk4pSPP4k5xhHqutqYgAB7USnesDnCcECwbgQMBAJUlk4VhgBD3JEg1TUr75iTijBghOKm/sxNDXUBl7CD6WMut0Q85x4RafwA/Es89DBXoTxuqxVFxyBbzt9Rav2HBUKl7hmkvLuKHLBCW57aK"}],validUntil:1792481054071,network:-239,from:"UQD8Szz0MFehPG6rFUXHIFvO31Fq_YcFQqXuGaS8u4ocsJdI"};try{var t=await N.sendTransaction(e);this.testboc=t.boc}catch(o){o instanceof m.UserRejectsError?this.testboc="用户拒绝交易":this.testboc="签名错误！"}},async testTonSdk(){if(N.connected)console.log("you have connected wallet");else{console.log("---connect Proof---\x3e>>>----",this.testProofPayload);let e={tonProof:this.testProofPayload,redirect:"tg://resolve",openUniversalUrl:!0};if(this.isPC()){e.redirect=null,e.openUniversalUrl=!1,console.log("Is PC, showing connectData",e);let t=await N.connect(e);console.log("Is PC, showing modal ==>",t),t&&(this.qrValue=t,this.showModal=!0)}else this.isSafariOrChrome()&&(e.redirect=null),console.log("Is Mobile ==>",e),await N.connect(e)}},closeModal(){this.showModal=!1},isPC(){const e=navigator.userAgent;console.log("current device ua is ===>",e);const t=["Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"];let o=!0;for(let n=0;n<t.length;n++)if(e.indexOf(t[n])>0){o=!1;break}return o},isSafariOrChrome(){const e=navigator.userAgent,t=["Safari","Chrome"];let o=!1;for(let n=0;n<t.length;n++)if(e.indexOf(t[n])>0){o=!0;break}return o}},created(){console.log("test sdk here"),console.log(N);const e=[m.OKX_TON_CONNECTION_STARTED,m.OKX_TON_CONNECTION_COMPLETED,m.OKX_TON_CONNECTION_ERROR,m.OKX_TON_CONNECTION_RESTORING_STARTED,m.OKX_TON_CONNECTION_RESTORING_COMPLETED,m.OKX_TON_CONNECTION_RESTORING_ERROR,m.OKX_TON_DISCONNECTION,m.OKX_TON_TRANSACTION_SENT_FOR_SIGNATURE,m.OKX_TON_TRANSACTION_SIGNED,m.OKX_TON_TRANSACTION_SIGNING_FAILED];e.forEach((e=>{window.addEventListener(e,(t=>{console.log(e,t.detail),this.currentStatus=e}))}))},mounted(){this.connectReady=!0;const e=S.getCryptoInfo();console.log(e),this.localPubKey=e.kp.publicKey,this.localSecKey=e.kp.secretKey,this.testPublicKey=this.localPubKey,this.testTopic=e.topic?.content,N.onStatusChange((e=>{if(console.log("--测试dapp 收到钱包数据----\x3e>>>----",e),e){if(this.walletAddress=e.account.address,this.testProofPayload){const t=this.walletAddress,o=e.connectItems?.tonProof?.proof.signature,n=e.connectItems?.tonProof?.proof.domain,l=e.account.publicKey;F(t,l,`${o}`,n.value).then((e=>{this.ProofPayloadVerify=e,console.log("Signature is valid:",e)})).catch((e=>{this.ProofPayloadVerify="Fail",console.error("Verification failed:",e)}))}else this.ProofPayloadVerify="--";this.showModal=!1}else this.walletAddress="已经断开了"}),(e=>{e instanceof m.UserRejectsError?this.walletAddress="用户拒绝链接":this.walletAddress=`链接报错 ！ ${e.message}`}))}},R=o(1241);const x=(0,R.A)(V,[["render",O],["__scopeId","data-v-dbfc2082"]]);var U=x;const L=(0,n.Ef)(U);L.use(l.A),L.mount("#app")},9432:function(){},6443:function(){},1281:function(){}},t={};function o(n){var l=t[n];if(void 0!==l)return l.exports;var a=t[n]={exports:{}};return e[n].call(a.exports,a,a.exports,o),a.exports}o.m=e,function(){var e=[];o.O=function(t,n,l,a){if(!n){var s=1/0;for(d=0;d<e.length;d++){n=e[d][0],l=e[d][1],a=e[d][2];for(var c=!0,r=0;r<n.length;r++)(!1&a||s>=a)&&Object.keys(o.O).every((function(e){return o.O[e](n[r])}))?n.splice(r--,1):(c=!1,a<s&&(s=a));if(c){e.splice(d--,1);var i=l();void 0!==i&&(t=i)}}return t}a=a||0;for(var d=e.length;d>0&&e[d-1][2]>a;d--)e[d]=e[d-1];e[d]=[n,l,a]}}(),function(){o.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(t,{a:t}),t}}(),function(){o.d=function(e,t){for(var n in t)o.o(t,n)&&!o.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})}}(),function(){o.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){var e={524:0};o.O.j=function(t){return 0===e[t]};var t=function(t,n){var l,a,s=n[0],c=n[1],r=n[2],i=0;if(s.some((function(t){return 0!==e[t]}))){for(l in c)o.o(c,l)&&(o.m[l]=c[l]);if(r)var d=r(o)}for(t&&t(n);i<s.length;i++)a=s[i],o.o(e,a)&&e[a]&&e[a][0](),e[a]=0;return o.O(d)},n=self["webpackChunkokxconnect"]=self["webpackChunkokxconnect"]||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))}();var n=o.O(void 0,[504],(function(){return o(4130)}));n=o.O(n)})();
//# sourceMappingURL=app.bcf23c3d.js.map